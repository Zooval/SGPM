{% extends 'base.html' %}

{% block title %}SGPM | Clientes{% endblock %}
{% block page_title %}Solicitantes{% endblock %}
{% block page_subtitle %}Gestión de solicitantes {% endblock %}

{% block extra_head %}
    {% load static %}
        <link rel="stylesheet" href="{% static 'css/menu.css' %}">
{% endblock %}

{% block page_content %}

    <!-- MAIN CONTENT -->
    <main class="main-content">

        <!-- TOPBAR -->
        <header class="topbar">
            <div class="topbar-title">
                <h2>Actualización de Datos</h2>
                <p>Modificar información del solicitante</p>
            </div>
            <div class="topbar-actions">
                <a href="{% url 'solicitante' %}" class="btn-secondary {% if request.resolver_match.url_name == 'solicitante' %}active{% endif %}">
                    <i class="fa-solid fa-arrow-left"></i>
                    Volver al Inicio
                </a>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <div class="content-area">

            <!-- Sección de Búsqueda -->
            <div class="search-section">
                <div class="search-card">
                    <h4><i class="fa-solid fa-magnifying-glass"></i> Buscar Solicitante</h4>
                    <p class="search-description">Ingrese la cédula del solicitante para buscarlo y editar sus datos de contacto</p>

                    <form method="get" class="search-form">
                        <div class="search-input-group">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">
                                    <i class="fa-solid fa-id-card"></i>
                                    Cédula / Documento
                                </label>
                                <input type="text" class="form-control" name="cedula" placeholder="Ej: 1234567890" value="{{ cedula_busqueda|default:'' }}">
                            </div>
                        </div>

                        <button type="submit" class="btn-primary">
                            <i class="fa-solid fa-search"></i>
                            Buscar Solicitante
                            <span class="arrow">→</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Sección de Datos Actuales (solo si hay resultado) -->
            {% if solicitante %}
            <div class="data-section" id="dataSection">

                <!-- Header con información del solicitante -->
                <div class="applicant-header">
                    <div class="applicant-avatar">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div class="applicant-info">
                        <h3 id="applicantName">{{ solicitante.nombre_completo }}</h3>
                        <div class="applicant-meta">
                            <span><i class="fa-solid fa-id-card"></i> ID: <strong id="applicantId">{{ solicitante.cedula }}</strong></span>
                            <span><i class="fa-solid fa-calendar"></i> Registrado: <strong>15/01/2026</strong></span>
                            <span class="status-badge active"><i class="fa-solid fa-circle-check"></i> Activo</span>
                        </div>
                    </div>
                    <div class="applicant-actions">
                        <button type="button" class="btn-edit" onclick="habilitarEdicion()">
                            <i class="fa-solid fa-pen-to-square"></i>
                            Habilitar Edición
                        </button>
                    </div>
                </div>

                <!-- Formulario de Actualización -->
                <form id="updateForm" class="update-form" method="post">
                    {% csrf_token %}

                    <!-- Datos Personales -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5><i class="fa-solid fa-user-circle"></i> Datos Personales</h5>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-signature"></i>
                                    Nombres
                                </label>
                                <input type="text" class="form-control" id="nombres" value="{{ solicitante.nombres }}" disabled>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-signature"></i>
                                    Apellidos
                                </label>
                                <input type="text" class="form-control" id="apellidos" value="{{ solicitante.apellidos }}" disabled>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-id-card"></i>
                                    Número de Identificación
                                </label>
                                <input type="text" class="form-control" id="identificacion" value="{{ solicitante.cedula }}" disabled>
                                <input type="hidden" name="cedula" value="{{ solicitante.cedula }}">
                                <small class="field-note">Este campo no se puede modificar</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-venus-mars"></i>
                                    Género
                                </label>
                                <select class="form-control" id="genero" disabled>
                                    <option value="M" selected>Masculino</option>
                                    <option value="F">Femenino</option>
                                    <option value="O">Otro</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-calendar-days"></i>
                                    Fecha de Nacimiento
                                </label>
                                <input type="date" class="form-control" id="fechaNacimiento" value="{{ solicitante.fecha_nacimiento|date:'Y-m-d' }}" disabled>
                            </div>
                        </div>
                    </div>

                    <!-- Datos de Contacto -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5><i class="fa-solid fa-address-book"></i> Datos de Contacto</h5>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-envelope"></i>
                                    Correo Electrónico
                                </label>
                                <input type="email" class="form-control" id="email" name="correo" value="{{ solicitante.correo }}" >
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-phone"></i>
                                    Teléfono
                                </label>
                                <input type="tel" class="form-control" id="telefono" name="telefono" value="{{ solicitante.telefono }}" >
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label class="form-label">
                                    <i class="fa-solid fa-location-dot"></i>
                                    Dirección
                                </label>
                                <input type="text" class="form-control" id="direccion" name="direccion" value="{{ solicitante.direccion|default:'' }}">
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-city"></i>
                                    Ciudad
                                </label>
                                <input type="text" class="form-control" id="ciudad" value="Quito" disabled>
                            </div>
                        </div>
                    </div>

                    <!-- Datos Migratorios -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5><i class="fa-solid fa-passport"></i> Datos Migratorios</h5>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-flag"></i>
                                    Nacionalidad
                                </label>
                                <select class="form-control" id="nacionalidad" disabled>
                                    <option value="EC" selected>Ecuador</option>
                                    <option value="VE">Venezuela</option>
                                    <option value="CO">Colombia</option>
                                    <option value="PE">Perú</option>
                                    <option value="BR">Brasil</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-file-lines"></i>
                                    Tipo de Solicitud
                                </label>
                                <select class="form-control" id="tipoSolicitud" disabled>
                                    <option value="visa" selected>Visa</option>
                                    <option value="residencia">Residencia</option>
                                    <option value="refugio">Refugio</option>
                                    <option value="asilo">Asilo</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fa-solid fa-circle-info"></i>
                                    Estado de Solicitud
                                </label>
                                <select class="form-control" id="estadoSolicitud" disabled>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="revision" selected>En Revisión</option>
                                    <option value="aprobado">Aprobado</option>
                                    <option value="rechazado">Rechazado</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Historial de Cambios -->
                    <!-- Botones de Acción -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="saveBtn">
                            <i class="fa-solid fa-floppy-disk"></i>
                            Guardar Cambios
                            <span class="arrow">→</span>
                        </button>
                    </div>

                </form>

            </div>
            {% endif %}

            <!-- Listado de solicitantes asociados -->
            <div class="data-section" style="margin-top: 2rem;">
                <div class="search-card">
                    <h4><i class="fa-solid fa-users"></i> Solicitantes Registrados</h4>
                    <p class="search-description">Listado rápido de solicitantes asociados al sistema</p>

                    <div style="overflow-x: auto; margin-top: 1rem;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--bg-main); border-bottom: 2px solid var(--border-color);">
                                    <th style="padding: 0.5rem; text-align: left;">Cédula</th>
                                    <th style="padding: 0.5rem; text-align: left;">Nombres</th>
                                    <th style="padding: 0.5rem; text-align: left;">Apellidos</th>
                                    <th style="padding: 0.5rem; text-align: left;">Correo</th>
                                    <th style="padding: 0.5rem; text-align: left;">Teléfono</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in solicitantes_lista %}
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 0.5rem;">{{ s.cedula }}</td>
                                    <td style="padding: 0.5rem;">{{ s.nombres }}</td>
                                    <td style="padding: 0.5rem;">{{ s.apellidos }}</td>
                                    <td style="padding: 0.5rem;">{{ s.correo }}</td>
                                    <td style="padding: 0.5rem;">{{ s.telefono }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" style="padding: 0.75rem; text-align: center; color: var(--text-muted);">
                                        No hay solicitantes registrados.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

{% endblock %}